<!doctype html><html lang=pt-br>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=content-language content="pt-br">
<meta name=color-scheme content="light dark">
<meta http-equiv=content-security-policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self'; form-action 'self'; frame-src 'self'; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'; prefetch-src 'self'; connect-src 'self';">
<meta name=author content="Eduardo Weiland">
<meta name=description content="Faz algum tempo que eu não publico nada sobre o projeto do Placarduino, mas ele não ficou parado esse tempo todo. Foram feitas duas atualizações, mas eu não tive tempo de organizar uma postagem sobre essas alterações. Então nesse post eu vou mostrar a modificação mais simples, que foi adicionar um botão para reduzir os pontos de um jogador (e.g. se o ponto foi adicionado por engano, agora existe um &ldquo;Ctrl+Z&rdquo;).">
<meta name=keywords content="blog,home,portfolio,personal,developer,maker">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Atualização do Placarduino: redução de pontos">
<meta name=twitter:description content="Faz algum tempo que eu não publico nada sobre o projeto do Placarduino, mas ele não ficou parado esse tempo todo. Foram feitas duas atualizações, mas eu não tive tempo de organizar uma postagem sobre essas alterações. Então nesse post eu vou mostrar a modificação mais simples, que foi adicionar um botão para reduzir os pontos de um jogador (e.g. se o ponto foi adicionado por engano, agora existe um &ldquo;Ctrl+Z&rdquo;).">
<meta property="og:title" content="Atualização do Placarduino: redução de pontos">
<meta property="og:description" content="Faz algum tempo que eu não publico nada sobre o projeto do Placarduino, mas ele não ficou parado esse tempo todo. Foram feitas duas atualizações, mas eu não tive tempo de organizar uma postagem sobre essas alterações. Então nesse post eu vou mostrar a modificação mais simples, que foi adicionar um botão para reduzir os pontos de um jogador (e.g. se o ponto foi adicionado por engano, agora existe um &ldquo;Ctrl+Z&rdquo;).">
<meta property="og:type" content="article">
<meta property="og:url" content="https://eduardoweiland.info/posts/2018/01/atualizacao-do-placarduino-reducao-de-pontos/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2018-01-13T11:19:50-02:00">
<meta property="article:modified_time" content="2018-01-13T11:19:50-02:00">
<meta property="og:see_also" content="https://eduardoweiland.info/posts/2018/02/reset-automatico-do-placarduino-apos-o-fim-do-jogo/"><meta property="og:see_also" content="https://eduardoweiland.info/posts/2018/02/fim-de-jogo-para-o-placarduino/"><meta property="og:see_also" content="https://eduardoweiland.info/posts/2018/01/cartoes-de-acesso-para-o-placarduino/"><meta property="og:see_also" content="https://eduardoweiland.info/posts/2018/01/refatoracao-do-placarduino/"><meta property="og:see_also" content="https://eduardoweiland.info/posts/2017/11/display-maior-numeros-maiores/">
<title>
Atualização do Placarduino: redução de pontos · Eduardo Weiland
</title>
<link rel=canonical href=https://eduardoweiland.info/posts/2018/01/atualizacao-do-placarduino-reducao-de-pontos/>
<link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.1.7" as=font type=font/woff2 crossorigin>
<link rel=stylesheet href=/css/coder.min.cbf6f68b2a836dd1d34f005153262dd21d148461cf33684940f1bb4c048821b1.css integrity="sha256-y/b2iyqDbdHTTwBRUyYt0h0UhGHPM2hJQPG7TASIIbE=" crossorigin=anonymous media=screen>
<link rel=stylesheet href=/css/coder-dark.min.dde8a61eb31a32353b4baf3d9113f03c4ea2a8ca9bb736f59ca2d2b2cb664f0b.css integrity="sha256-3eimHrMaMjU7S689kRPwPE6iqMqbtzb1nKLSsstmTws=" crossorigin=anonymous media=screen>
<link rel=stylesheet href=/css/custom.css>
<link rel=icon type=image/png href=/images/favicon32.png sizes=32x32>
<link rel=icon type=image/png href=/images/favicon16.png sizes=16x16>
<link rel=apple-touch-icon href=/images/apple-touch-icon.png>
<link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png>
<meta name=generator content="Hugo 0.88.1">
</head>
<body class="preload-transitions colorscheme-auto">
<div class=float-container>
<a id=dark-mode-toggle class=colorscheme-toggle>
<i class="fa fa-adjust fa-fw" aria-hidden=true></i>
</a>
</div>
<main class=wrapper>
<nav class=navigation>
<section class=container>
<a class=navigation-title href=/>
Eduardo Weiland
</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle>
<i class="fa fa-bars fa-fw" aria-hidden=true></i>
</label>
<ul class=navigation-list>
<li class=navigation-item>
<a class=navigation-link href=/posts/>Blog</a>
</li>
</ul>
</section>
</nav>
<div class=content>
<section class="container post">
<article>
<header>
<div class=post-title>
<h1 class=title>
<a class=title-link href=https://eduardoweiland.info/posts/2018/01/atualizacao-do-placarduino-reducao-de-pontos/>
Atualização do Placarduino: redução de pontos
</a>
</h1>
</div>
<div class=post-meta>
<div class=date>
<span class=posted-on>
<i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2018-01-13T11:19:50-02:00>
Jan 13, 2018
</time>
</span>
<span class=reading-time>
<i class="fa fa-clock-o" aria-hidden=true></i>
4 minutos de leitura
</span>
</div>
<div class=tags>
<i class="fa fa-tag" aria-hidden=true></i>
<a href=/tags/arduino/>arduino</a>
<span class=separator>•</span>
<a href=/tags/eletronica/>eletronica</a>
<span class=separator>•</span>
<a href=/tags/placarduino/>placarduino</a></div>
</div>
</header>
<div>
<img src=/images/placarduino-push-buttons-diminuir-pontos.png alt="Featured image">
<p>Faz algum tempo que eu não publico nada sobre o projeto do <a href=/posts/2017/10/placarduino-placar-eletronico-com-arduino/>Placarduino</a>, mas
ele não ficou parado esse tempo todo. Foram feitas duas atualizações, mas eu não
tive tempo de organizar uma postagem sobre essas alterações. Então nesse post eu
vou mostrar a modificação mais simples, que foi adicionar um botão para reduzir
os pontos de um jogador (e.g. se o ponto foi adicionado por engano, agora existe
um &ldquo;Ctrl+Z&rdquo;).</p>
<h2 id=planejamento>
Planejamento
<a class=heading-link href=#planejamento>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>Antes dessa alteração, existiam apenas dois botões no circuito, um para cada
jogador. Ao pressionar um dos botões, era somado 1 aos pontos do respectivo
jogador. Agora serão adicionados mais dois botões, também um para cada jogador,
que serão utilizados para subtrair 1 dos pontos do respectivo jogador.</p>
<p>Para essa alteração, serão utilizados:</p>
<ul>
<li>2 push buttons</li>
<li>2 resistores 10 kΩ</li>
<li>Alguns cabos jumper</li>
</ul>
<h2 id=ligação-dos-pushbuttons>
Ligação dos pushbuttons
<a class=heading-link href=#liga%c3%a7%c3%a3o-dos-pushbuttons>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>A ligação dos novos pushbuttons no circuito é a mesma dos dois botões já
existentes: 5V em um dos terminais e o resistor de 10 kΩ entre o outro terminal
e o GND. Nesse terminal com o resistor também é adicionado um fio ligado a uma
das entradas digitais do Arduino.</p>
<p>Para facilitar as ligações, os pinos utilizados foram 4, 5, 6 e 7. Antes,
eram utilizados apenas os pinos 6 e 7, e o pino 5 estava em uso para ligação do
<a href=/posts/2017/10/adicionando-sons-no-placarduino/>buzzer adicionado para emitir sons</a>. O buzzer foi movido para o pino 3 e os
os botões foram ligados conforme a imagem a seguir.</p>
<p><img src=/images/placarduino-push-buttons-diminuir-pontos.png alt="Esquema de ligação dos novos push buttons"></p>
<p>Isso é tudo que precisa ser alterado no circuito. O resto é apenas código.</p>
<h2 id=alterações-no-código>
Alterações no código
<a class=heading-link href=#altera%c3%a7%c3%b5es-no-c%c3%b3digo>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>A primeira alteração necessária, como já foi comentado, é a alteração dos pinos
utilizados:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#6272a4>// Configurações de pinos
</span><span style=color:#6272a4></span><span style=color:#ff79c6>#define PIN_BTN_SUB_PL1   7
</span><span style=color:#ff79c6>#define PIN_BTN_ADD_PL1   6
</span><span style=color:#ff79c6>#define PIN_BTN_SUB_PL2   5
</span><span style=color:#ff79c6>#define PIN_BTN_ADD_PL2   4
</span><span style=color:#ff79c6></span>
<span style=color:#ff79c6>#define PIN_BUZZER        3
</span></code></pre></div><p>A função <code>setupInputs()</code> também precisa ser alterada para utilizar as novas
constantes:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>setupInputs</span>()
{
    pinMode(PIN_BTN_SUB_PL1, INPUT);
    pinMode(PIN_BTN_ADD_PL1, INPUT);
    pinMode(PIN_BTN_SUB_PL2, INPUT);
    pinMode(PIN_BTN_ADD_PL2, INPUT);
}
</code></pre></div><p>Além de alterar os pinos utilizados no Arduino, as variáveis utilizadas para
salvar o estado dos botões também precisam ser modificadas:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#6272a4>// Configurações dos jogadores e placar
</span><span style=color:#6272a4></span><span style=color:#ff79c6>const</span> <span style=color:#8be9fd>char</span> firstPlayerName[] <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;Jogador 1&#34;</span>;
<span style=color:#8be9fd>int</span> firstPlayerScore <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
<span style=color:#8be9fd>int</span> subPlayer1ButtonState <span style=color:#ff79c6>=</span> LOW;
<span style=color:#8be9fd>int</span> addPlayer1ButtonState <span style=color:#ff79c6>=</span> LOW;

<span style=color:#ff79c6>const</span> <span style=color:#8be9fd>char</span> secondPlayerName[] <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;Jogador 2&#34;</span>;
<span style=color:#8be9fd>int</span> secondPlayerScore <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
<span style=color:#8be9fd>int</span> subPlayer2ButtonState <span style=color:#ff79c6>=</span> LOW;
<span style=color:#8be9fd>int</span> addPlayer2ButtonState <span style=color:#ff79c6>=</span> LOW;
</code></pre></div><p>Agora a parte mais trabalhosa (mas não muito) dessa alteração: a verificação dos
botões e alteração do placar. A função <code>checkButtons()</code>, que antes fazia tudo,
foi refatorada: foi adicionada a função <code>checkScoreInput()</code> para verificar cada
botão, e a função <code>checkButtons()</code> chama essa nova função 4 vezes, uma para cada
botão do circuito.</p>
<p><code>checkScoreInput()</code> recebe 5 parâmetros:</p>
<ul>
<li><code>int inputPin</code> é o número do pino que deve ser lido (uma das constantes <code>PIN_BTN_*</code>)</li>
<li><code>int *stateStore</code> é um ponteiro para a variável onde deve ser salvo o estado
do botão (uma das variáveis <code>(add|sub)PlayerNButtonState</code>)</li>
<li><code>unsigned int *scoreStore</code> é um ponteiro para a variável onde deve ser salvo
o placar do jogador (uma das variáveis <code>(first|second)PlayerScore</code>)</li>
<li><code>int op</code> é a operação a ser executada, ou seja, quantos pontos deve ser
adicionados ou subtraídos do placar (+1 ou -1)</li>
<li><code>void(*feedbackFunction)()</code> é um ponteiro para uma função de feedback, que
são as funções que tocam um som ao alterar o placar (mostradas mais adiante)</li>
</ul>
<p>Talvez a parte mais complicada seja o ponteiro de função. Não é realmente um
código bonito, mas funciona. Para aprender mais sobre ponteiros de funções,
pesquise no <del>Google</del> DuckDuckGo.</p>
<p>O código completo da função até que é bem simples, muito semelhante ao que já
era feito antes:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>checkScoreInput</span>(
    <span style=color:#8be9fd>int</span> inputPin,
    <span style=color:#8be9fd>int</span> <span style=color:#ff79c6>*</span>stateStore,
    <span style=color:#8be9fd>int</span> <span style=color:#ff79c6>*</span>scoreStore,
    <span style=color:#8be9fd>int</span> op,
    <span style=color:#8be9fd>void</span>(<span style=color:#ff79c6>*</span>feedbackFunction)()
)
{
    <span style=color:#8be9fd>int</span> newButtonState <span style=color:#ff79c6>=</span> digitalRead(inputPin);

    <span style=color:#ff79c6>if</span> (newButtonState <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>*</span>stateStore <span style=color:#ff79c6>&amp;&amp;</span> newButtonState <span style=color:#ff79c6>==</span> HIGH) {
        <span style=color:#6272a4>// Placar não deve ficar negativo, então a operação
</span><span style=color:#6272a4></span>        <span style=color:#6272a4>// só é feita se o placar for continuar &gt;= 0
</span><span style=color:#6272a4></span>        <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>*</span>scoreStore <span style=color:#ff79c6>+</span> op <span style=color:#ff79c6>&gt;=</span> <span style=color:#bd93f9>0</span>) {
            <span style=color:#ff79c6>*</span>scoreStore <span style=color:#ff79c6>+=</span> op;
            printScore();
            feedbackFunction();
        }
    }

    <span style=color:#ff79c6>*</span>stateStore <span style=color:#ff79c6>=</span> newButtonState;
}
</code></pre></div><p>E mais simples ainda ficou o <code>checkButtons()</code>, que apenas chama essa função com
os parâmetros corretos:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>checkButtons</span>()
{
    checkScoreInput(PIN_BTN_ADD_PL1, <span style=color:#ff79c6>&amp;</span>addPlayer1ButtonState, <span style=color:#ff79c6>&amp;</span>firstPlayerScore, <span style=color:#ff79c6>+</span><span style=color:#bd93f9>1</span>, playFeedbackPositive);
    checkScoreInput(PIN_BTN_SUB_PL1, <span style=color:#ff79c6>&amp;</span>subPlayer1ButtonState, <span style=color:#ff79c6>&amp;</span>firstPlayerScore, <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>, playFeedbackNegative);
    checkScoreInput(PIN_BTN_ADD_PL2, <span style=color:#ff79c6>&amp;</span>addPlayer2ButtonState, <span style=color:#ff79c6>&amp;</span>secondPlayerScore, <span style=color:#ff79c6>+</span><span style=color:#bd93f9>1</span>, playFeedbackPositive);
    checkScoreInput(PIN_BTN_SUB_PL2, <span style=color:#ff79c6>&amp;</span>subPlayer2ButtonState, <span style=color:#ff79c6>&amp;</span>secondPlayerScore, <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>, playFeedbackNegative);
}
</code></pre></div><p>Para finalizar, a última alteração é nas funções de <em>feedback</em>. Antes existia
apenas uma, que era utilizada ao incrementar o placar de um jogador. Agora são
duas, uma ao adicionar e outra ao subtrair um ponto do placar.</p>
<p>A antiga função <code>playFeedback()</code> apenas foi renomeada para <code>playFeedbackPositive()</code>,
e a função <code>playFeedbackNegative()</code> foi criada com a ordem inversa das notas:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>playFeedbackPositive</span>()
{
    buzzer.play(NOTE_C6, <span style=color:#bd93f9>120</span>);
    delay(<span style=color:#bd93f9>140</span>);

    buzzer.play(NOTE_C7, <span style=color:#bd93f9>420</span>);
    delay(<span style=color:#bd93f9>500</span>);
}

<span style=color:#8be9fd>void</span> <span style=color:#50fa7b>playFeedbackNegative</span>()
{
    buzzer.play(NOTE_C7, <span style=color:#bd93f9>120</span>);
    delay(<span style=color:#bd93f9>140</span>);

    buzzer.play(NOTE_C6, <span style=color:#bd93f9>420</span>);
    delay(<span style=color:#bd93f9>500</span>);
}
</code></pre></div><h2 id=finalizando>
Finalizando
<a class=heading-link href=#finalizando>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>Isso é tudo, pessoal!™</p>
<p>Como eu comentei no início do post, foram feitas duas alterações no Placarduino
que não foram postadas aqui. Essa foi uma delas, e foi bem simples. Mas a segunda
alteração foi a melhor de todas e merece um post separado: identificação dos
jogadores com cartões RFID. Em breve eu publico essa postagem aqui no blog.</p>
<p>Enquanto isso, não deixe de conferir o projeto no GitHub:</p>
<ul>
<li>Versão desse post: <a href=https://github.com/eduardoweiland/placarduino/tree/v1.4>https://github.com/eduardoweiland/placarduino/tree/v1.4</a></li>
<li>Versão mais recente: <a href=https://github.com/eduardoweiland/placarduino>https://github.com/eduardoweiland/placarduino</a></li>
</ul>
</div>
<footer>
<section class=see-also>
<h3 id=see-also-in-placarduino>
See also in placarduino
<a class=heading-link href=#see-also-in-placarduino>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h3>
<nav>
<ul>
<li>
<a href=/posts/2018/02/reset-automatico-do-placarduino-apos-o-fim-do-jogo/>Reset automático do Placarduino após o fim do jogo</a>
</li>
<li>
<a href=/posts/2018/02/fim-de-jogo-para-o-placarduino/>Fim de jogo para o Placarduino</a>
</li>
<li>
<a href=/posts/2018/01/cartoes-de-acesso-para-o-placarduino/>Cartões de acesso para o Placarduino</a>
</li>
<li>
<a href=/posts/2018/01/refatoracao-do-placarduino/>Refatoração do Placarduino</a>
</li>
<li>
<a href=/posts/2017/11/display-maior-numeros-maiores/>Display maior, números maiores</a>
</li>
</ul>
</nav>
</section>
</footer>
</article>
</section>
</div>
<footer class=footer>
<section class=container>
&copy;
2011 -
2021
Eduardo Weiland
&#183;
<a rel="license noopener" href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA 4.0</a>
&#183;
<a rel=noopener href=https://gitlab.com/eduardoweiland/homepage>Free Software</a>
</section>
</footer>
</main>
<script src=/js/coder.min.235666b114443867d43eeb5799d51f6252965e5163f338285e113fa381d3d27e.js integrity="sha256-I1ZmsRREOGfUPutXmdUfYlKWXlFj8zgoXhE/o4HT0n4="></script>
</body>
</html>