<!doctype html><html lang=pt-br>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=content-language content="pt-br">
<meta name=color-scheme content="light dark">
<meta http-equiv=content-security-policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self'; form-action 'self'; frame-src 'self'; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'; prefetch-src 'self'; connect-src 'self';">
<meta name=author content="Eduardo Weiland">
<meta name=description content="No √∫ltimo post sobre o projeto do Placarduino, eu adicionei um display de 4 linhas e 20 colunas, mas n√£o alterei o formato de exibi√ß√£o do placar. Eu reservei essa mudan√ßa para este post: exibir n√∫meros maiores no placar.
Indo direto ao ponto, o resultado ser√° como a imagem acima.
A teoria    Os displays LCD utilizam uma matriz de pixels de 8 linhas e 5 colunas para cada caractere.">
<meta name=keywords content="blog,home,portfolio,personal,developer,maker">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Display maior, n√∫meros maiores">
<meta name=twitter:description content="No √∫ltimo post sobre o projeto do Placarduino, eu adicionei um display de 4 linhas e 20 colunas, mas n√£o alterei o formato de exibi√ß√£o do placar. Eu reservei essa mudan√ßa para este post: exibir n√∫meros maiores no placar.
Indo direto ao ponto, o resultado ser√° como a imagem acima.
A teoria    Os displays LCD utilizam uma matriz de pixels de 8 linhas e 5 colunas para cada caractere.">
<meta property="og:title" content="Display maior, n√∫meros maiores">
<meta property="og:description" content="No √∫ltimo post sobre o projeto do Placarduino, eu adicionei um display de 4 linhas e 20 colunas, mas n√£o alterei o formato de exibi√ß√£o do placar. Eu reservei essa mudan√ßa para este post: exibir n√∫meros maiores no placar.
Indo direto ao ponto, o resultado ser√° como a imagem acima.
A teoria    Os displays LCD utilizam uma matriz de pixels de 8 linhas e 5 colunas para cada caractere.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://eduardoweiland.info/posts/2017/11/display-maior-numeros-maiores/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2017-11-05T18:18:55-02:00">
<meta property="article:modified_time" content="2017-11-05T18:18:55-02:00">
<meta property="og:see_also" content="https://eduardoweiland.info/posts/2018/02/reset-automatico-do-placarduino-apos-o-fim-do-jogo/"><meta property="og:see_also" content="https://eduardoweiland.info/posts/2018/02/fim-de-jogo-para-o-placarduino/"><meta property="og:see_also" content="https://eduardoweiland.info/posts/2018/01/cartoes-de-acesso-para-o-placarduino/"><meta property="og:see_also" content="https://eduardoweiland.info/posts/2018/01/refatoracao-do-placarduino/"><meta property="og:see_also" content="https://eduardoweiland.info/posts/2018/01/atualizacao-do-placarduino-reducao-de-pontos/">
<title>
Display maior, n√∫meros maiores ¬∑ Eduardo Weiland
</title>
<link rel=canonical href=https://eduardoweiland.info/posts/2017/11/display-maior-numeros-maiores/>
<link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.1.7" as=font type=font/woff2 crossorigin>
<link rel=stylesheet href=/css/coder.min.cbf6f68b2a836dd1d34f005153262dd21d148461cf33684940f1bb4c048821b1.css integrity="sha256-y/b2iyqDbdHTTwBRUyYt0h0UhGHPM2hJQPG7TASIIbE=" crossorigin=anonymous media=screen>
<link rel=stylesheet href=/css/coder-dark.min.dde8a61eb31a32353b4baf3d9113f03c4ea2a8ca9bb736f59ca2d2b2cb664f0b.css integrity="sha256-3eimHrMaMjU7S689kRPwPE6iqMqbtzb1nKLSsstmTws=" crossorigin=anonymous media=screen>
<link rel=stylesheet href=/css/custom.css>
<link rel=icon type=image/png href=/images/favicon32.png sizes=32x32>
<link rel=icon type=image/png href=/images/favicon16.png sizes=16x16>
<link rel=apple-touch-icon href=/images/apple-touch-icon.png>
<link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png>
<meta name=generator content="Hugo 0.88.1">
</head>
<body class="preload-transitions colorscheme-auto">
<div class=float-container>
<a id=dark-mode-toggle class=colorscheme-toggle>
<i class="fa fa-adjust fa-fw" aria-hidden=true></i>
</a>
</div>
<main class=wrapper>
<nav class=navigation>
<section class=container>
<a class=navigation-title href=/>
Eduardo Weiland
</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle>
<i class="fa fa-bars fa-fw" aria-hidden=true></i>
</label>
<ul class=navigation-list>
<li class=navigation-item>
<a class=navigation-link href=/posts/>Blog</a>
</li>
</ul>
</section>
</nav>
<div class=content>
<section class="container post">
<article>
<header>
<div class=post-title>
<h1 class=title>
<a class=title-link href=https://eduardoweiland.info/posts/2017/11/display-maior-numeros-maiores/>
Display maior, n√∫meros maiores
</a>
</h1>
</div>
<div class=post-meta>
<div class=date>
<span class=posted-on>
<i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2017-11-05T18:18:55-02:00>
Nov 5, 2017
</time>
</span>
<span class=reading-time>
<i class="fa fa-clock-o" aria-hidden=true></i>
10 minutos de leitura
</span>
</div>
<div class=tags>
<i class="fa fa-tag" aria-hidden=true></i>
<a href=/tags/arduino/>arduino</a>
<span class=separator>‚Ä¢</span>
<a href=/tags/eletronica/>eletronica</a>
<span class=separator>‚Ä¢</span>
<a href=/tags/placarduino/>placarduino</a></div>
</div>
</header>
<div>
<img src=/images/placarduino-big-numbers-lcd.jpg alt="Featured image">
<p>No <a href=/posts/2017/11/placarduino-adicionando-um-display-maior-para-exibir-mais-informacoes/>√∫ltimo post sobre o projeto do Placarduino</a>, eu adicionei um display de 4
linhas e 20 colunas, mas n√£o alterei o formato de exibi√ß√£o do placar. Eu reservei
essa mudan√ßa para este post: exibir n√∫meros maiores no placar.</p>
<p>Indo direto ao ponto, o resultado ser√° como a imagem acima.</p>
<h2 id=a-teoria>
A teoria
<a class=heading-link href=#a-teoria>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>Os displays LCD utilizam uma matriz de pixels de 8 linhas e 5 colunas para cada
caractere. Os pixels que devem ser ligados s√£o representados por um bit 1 e os
pixels desligados por 0. Cada caractere √© formado por um vetor de 8 bytes, onde
apenas os 5 bits menos significativos de cada byte representam uma linha de pixels.</p>
<p>Por exemplo, a letra &ldquo;E&rdquo; √© exibida no display que eu tenho como:</p>
<p><img src=/images/display-lcd-letra-E.png alt="Representa√ß√£o da letra E no display LCD"></p>
<p>A representa√ß√£o em bits desse caractere √©:</p>
<p><img src=/images/display-lcd-letra-E-bits.png alt="Representa√ß√£o em bits da letra E no display LCD"></p>
<p>O que equivale ao seguinte c√≥digo no Arduino:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>byte letraE[<span style=color:#bd93f9>8</span>] <span style=color:#ff79c6>=</span> {
    B11111,
    B10000,
    B10000,
    B11110,
    B10000,
    B10000,
    B11111,
    B00000
};
</code></pre></div><p>Essas configura√ß√µes de exibi√ß√£o s√£o salvas na mem√≥ria do controlador do LCD
utilizando o c√≥digo ASCII do caractere como endere√ßo. Por exemplo, o c√≥digo da
letra E na tabela ASCII √© 0x45, ent√£o esse √© o endere√ßo desse caractere na
mem√≥ria.</p>
<p>Para exibir um caractere no display, o microcontrolador (nesse caso, o Atmega328
do Arduino) envia para o controlador do LCD o c√≥digo ASCII do caractere e o
controlador busca na mem√≥ria interna como ele deve ser exibido. Infelizmente
essa mem√≥ria do controlador √© somente leitura. Felizmente o controlador possui
uma outra √°rea de mem√≥ria que pode ser escrita - <em>pelo menos √© o que eu encontrei
<a href=https://www.engineersgarage.com/embedded/arduino/how-to-create-custom-characters-in-lcd-using-arduino>nesse post</a></em>.</p>
<p>Essa √°rea de mem√≥ria secund√°ria possui 64 bytes. Como cada caractere utiliza 8
bytes, isso d√° 64 / 8 = 8 caracteres. A faixa de endere√ßos dos caracteres que
podem ser configurados √© de 0 a 7, que na tabela ASCII s√£o caracteres de controle
e n√£o tem nenhuma exibi√ß√£o por padr√£o.</p>
<p>Um detalhe importante a ser lembrado √© que os caracteres que est√£o sendo exibidos
no LCD est√£o ligados diretamente a essa mem√≥ria. Ent√£o, se voc√™ reconfigurar um
caractere, todos os caracteres com o mesmo c√≥digo que j√° est√£o no LCD ser√£o
&ldquo;atualizados&rdquo; para a nova exibi√ß√£o (descobri isso na pr√°tica).</p>
<h2 id=criando-os-caracteres-para-exibir-n√∫meros-grandes>
Criando os caracteres para exibir n√∫meros grandes
<a class=heading-link href=#criando-os-caracteres-para-exibir-n%c3%bameros-grandes>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>O display LCD exibe caracteres de apenas 8x5 pixels. Mas, com um pouco de
criatividade, √© poss√≠vel combinar v√°rios caracteres de 8x5 para formar letras,
n√∫meros ou at√© s√≠mbolos maiores. No caso do Placarduino, isso ser√° utilizado
apenas para exibir os n√∫meros da pontua√ß√£o em um tamanho maior, ent√£o s√≥ √©
preciso criar os n√∫meros de 0 a 9.</p>
<p>Eu defini que o tamanho de cada n√∫mero seria 3x3 caracteres. Com isso, eu
mantenho uma linha livre para exibir o nome do jogador sobre o placar e tamb√©m
posso exibir dois n√∫meros lado a lado para pontua√ß√µes de at√© 99.</p>
<p>O processo que eu utilizei para criar os caracteres foi bem simples: comecei do
0 e fui criando cada n√∫mero at√© chegar no 9. Criei os caracteres customizados
conforme a necessidade, e no fim acabei utilizando exatamente os 8 dispon√≠veis.</p>
<p>Para criar cada parte do n√∫mero, um site que pode ajudar √© esse <a href=https://omerk.github.io/lcdchargen/>gerador de
caracteres customizados</a>. Ele s√≥ edita um caractere por vez, ent√£o para
visualizar o resultado eu criei um sketch separado no Arduino para juntar as
partes e ver o n√∫mero completo.</p>
<p>O resultado disso foi a cria√ß√£o de uma biblioteca LcdBigNumbers dentro do projeto.
Usando a <a href=/posts/2017/10/substituindo-a-ide-do-arduino-pelo-platformio/>estrutura do PlatformIO</a>, a biblioteca ficou bem isolada do resto do
c√≥digo e bem simples de utilizar, apenas com um arquivo <code>.h</code> e um <code>.cpp</code>.</p>
<h3 id=defini√ß√£o-da-classe>
Defini√ß√£o da classe
<a class=heading-link href=#defini%c3%a7%c3%a3o-da-classe>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h3>
<p>O arquivo de cabe√ßalho da biblioteca ficou localizado em <code>lib/LcdBigNumbers/LcdBigNumbers.h</code>.
Esse arquivo √© bem simples e cont√©m a defini√ß√£o de uma classe com um construtor
e tr√™s m√©todos p√∫blicos.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#6272a4>// lib/LcdBigNumbers/LcdBigNumbers.h
</span><span style=color:#6272a4></span>
<span style=color:#ff79c6>#ifndef PLACARDUINO_LCD_BIG_NUMBERS_H
</span><span style=color:#ff79c6>#define PLACARDUINO_LCD_BIG_NUMBERS_H
</span><span style=color:#ff79c6></span>
<span style=color:#ff79c6>class</span> <span style=color:#50fa7b>LiquidCrystal_I2C</span>;

<span style=color:#ff79c6>class</span> <span style=color:#50fa7b>LcdBigNumbers</span>
{
<span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
    LcdBigNumbers(LiquidCrystal_I2C <span style=color:#ff79c6>*</span>lcd);

    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>init</span>();
    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>printNumber</span>(<span style=color:#ff79c6>const</span> <span style=color:#8be9fd>unsigned</span> <span style=color:#8be9fd>long</span> <span style=color:#8be9fd>int</span> number, <span style=color:#8be9fd>uint8_t</span> column, <span style=color:#8be9fd>uint8_t</span> row);
    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>printDigit</span>(<span style=color:#ff79c6>const</span> <span style=color:#8be9fd>uint8_t</span> digit, <span style=color:#8be9fd>uint8_t</span> column, <span style=color:#8be9fd>uint8_t</span> row);

<span style=color:#ff79c6>private</span><span style=color:#ff79c6>:</span>
    LiquidCrystal_I2C <span style=color:#ff79c6>*</span>lcd;
};

<span style=color:#ff79c6>#endif </span><span style=color:#6272a4>// PLACARDUINO_LCD_BIG_NUMBERS_H
</span></code></pre></div><p>Vendo o construtor, ele recebe um ponteiro para o objeto do LCD. <em><a href=https://en.wikipedia.org/wiki/Dependency_injection>Dependency
Injection</a></em> no Arduino üòÑ. Infelizmente, n√£o existe uma interface padr√£o entre
as bibliotecas do LiquidCrystal, ent√£o foi necess√°rio utilizar a classe
LiquidCrystal_I2C diretamente.</p>
<p>Al√©m do construtor, existem tamb√©m um m√©todo <code>init()</code> que ser√° utilizado para
criar os caracteres na mem√≥ria do controlador do LCD, um m√©todo <code>printNumber()</code>
para exibir um n√∫mero em uma posi√ß√£o espec√≠fica do display, e o m√©todo
<code>printDigit()</code> que exibe um √∫nico d√≠gito no LCD tamb√©m em uma posi√ß√£o espec√≠fica.</p>
<h3 id=configura√ß√£o-dos-caracteres>
Configura√ß√£o dos caracteres
<a class=heading-link href=#configura%c3%a7%c3%a3o-dos-caracteres>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h3>
<p>O arquivo que possui toda a configura√ß√£o dos caracteres customizados, bem como
a l√≥gica para exibir os n√∫meros maiores compostos de 9 caracteres (3x3) √©
<code>lib/LcdBigNumbers/LcdBigNumbers.cpp</code>.</p>
<p>No come√ßo do arquivo s√£o inclu√≠dos os arquivos de cabe√ßalho necess√°rios:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;inttypes.h&gt;</span><span style=color:#ff79c6>
</span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;binary.h&gt;</span><span style=color:#ff79c6>
</span><span style=color:#ff79c6></span>
<span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;LiquidCrystal_I2C.h&gt;</span><span style=color:#ff79c6>
</span><span style=color:#ff79c6></span>
<span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&#34;LcdBigNumbers.h&#34;</span><span style=color:#ff79c6>
</span></code></pre></div><p>Logo depois, eu criei algumas constantes para identificar os caracteres
customizados, al√©m de outros caracteres do pr√≥prio controlador do LCD que foram
utilizados:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#ff79c6>#define CHAR_TOP_LEFT       0
</span><span style=color:#ff79c6>#define CHAR_TOP_RIGHT      1
</span><span style=color:#ff79c6>#define CHAR_BOTTOM_LEFT    2
</span><span style=color:#ff79c6>#define CHAR_BOTTOM_RIGHT   3
</span><span style=color:#ff79c6>#define CHAR_HALF_TOP       4
</span><span style=color:#ff79c6>#define CHAR_HALF_BOTTOM    5
</span><span style=color:#ff79c6>#define CHAR_TOP_BOTTOM     6
</span><span style=color:#ff79c6>#define CHAR_MIDDLE         7
</span><span style=color:#ff79c6>#define CHAR_EMPTY        254
</span><span style=color:#ff79c6>#define CHAR_FULL         255
</span></code></pre></div><p>Esses s√£o os endere√ßos dos caracteres na mem√≥ria do controlador LCD. Os √∫ltimos
dois, <code>CHAR_EMPTY</code> e <code>CHAR_FULL</code>, j√° existem por padr√£o na mem√≥ria do LCD e n√£o
√© necess√°rio cri√°-los. A defini√ß√£o de cada pixel desses caracteres vem logo
depois, em uma matriz de bytes no formato j√° mencionado, utilizando o endere√ßo
do caractere como √≠ndice do vetor:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#ff79c6>static</span> <span style=color:#8be9fd>uint8_t</span> customChars[<span style=color:#bd93f9>8</span>][<span style=color:#bd93f9>8</span>] <span style=color:#ff79c6>=</span>
{
    <span style=color:#6272a4>// CHAR_TOP_LEFT
</span><span style=color:#6272a4></span>    {
        B00001,
        B00111,
        B01111,
        B01111,
        B11111,
        B11111,
        B11111,
        B11111
    },

    <span style=color:#6272a4>// CHAR_TOP_RIGHT
</span><span style=color:#6272a4></span>    {
        B10000,
        B11100,
        B11110,
        B11110,
        B11111,
        B11111,
        B11111,
        B11111
    },

    <span style=color:#6272a4>// CHAR_BOTTOM_LEFT
</span><span style=color:#6272a4></span>    {
        B11111,
        B11111,
        B11111,
        B11111,
        B01111,
        B01111,
        B00111,
        B00001
    },

    <span style=color:#6272a4>// CHAR_BOTTOM_RIGHT
</span><span style=color:#6272a4></span>    {
        B11111,
        B11111,
        B11111,
        B11111,
        B11110,
        B11110,
        B11100,
        B10000
    },

    <span style=color:#6272a4>// CHAR_HALF_TOP
</span><span style=color:#6272a4></span>    {
        B11111,
        B11111,
        B11111,
        B11111,
        B00000,
        B00000,
        B00000,
        B00000
    },

    <span style=color:#6272a4>// CHAR_HALF_BOTTOM
</span><span style=color:#6272a4></span>    {
        B00000,
        B00000,
        B00000,
        B00000,
        B11111,
        B11111,
        B11111,
        B11111
    },

    <span style=color:#6272a4>// CHAR_TOP_BOTTOM
</span><span style=color:#6272a4></span>    {
        B11111,
        B11111,
        B11111,
        B00000,
        B00000,
        B11111,
        B11111,
        B11111
    },

    <span style=color:#6272a4>// CHAR_MIDDLE
</span><span style=color:#6272a4></span>    {
        B00000,
        B00000,
        B00000,
        B11111,
        B11111,
        B00000,
        B00000,
        B00000
    }
};
</code></pre></div><p>Os caracteres que s√£o criados com essas configura√ß√µes s√£o os seguintes:</p>
<p><img src=/images/custom-chars-lcd-big-number.png alt="Todos os caracteres utilizados na biblioteca LcdBigNumbers"></p>
<p>Depois de ter esses caracteres criados, cada n√∫mero √© configurado como uma matriz
3x3 com os c√≥digos desses caracteres. Como a matriz tem n√∫meros de 0 a 9, o
pr√≥prio n√∫mero foi utilizado como √≠ndice:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#ff79c6>static</span> <span style=color:#8be9fd>uint8_t</span> numberChars[<span style=color:#bd93f9>10</span>][<span style=color:#bd93f9>3</span>][<span style=color:#bd93f9>3</span>] <span style=color:#ff79c6>=</span>
{
    <span style=color:#6272a4>// 0
</span><span style=color:#6272a4></span>    {
        { CHAR_TOP_LEFT, CHAR_HALF_TOP, CHAR_TOP_RIGHT },
        { CHAR_FULL, CHAR_EMPTY, CHAR_FULL },
        { CHAR_BOTTOM_LEFT, CHAR_HALF_BOTTOM, CHAR_BOTTOM_RIGHT }
    },

    <span style=color:#6272a4>// 1
</span><span style=color:#6272a4></span>    {
        { CHAR_HALF_BOTTOM, CHAR_FULL, CHAR_EMPTY },
        { CHAR_EMPTY, CHAR_FULL, CHAR_EMPTY },
        { CHAR_HALF_BOTTOM, CHAR_FULL, CHAR_HALF_BOTTOM }
    },

    <span style=color:#6272a4>// 2
</span><span style=color:#6272a4></span>    {
        { CHAR_HALF_TOP, CHAR_HALF_TOP, CHAR_HALF_BOTTOM },
        { CHAR_HALF_BOTTOM, CHAR_MIDDLE, CHAR_HALF_TOP },
        { CHAR_FULL, CHAR_HALF_BOTTOM, CHAR_HALF_BOTTOM }
    },

    <span style=color:#6272a4>// 3
</span><span style=color:#6272a4></span>    {
        { CHAR_HALF_TOP, CHAR_HALF_TOP, CHAR_HALF_BOTTOM },
        { CHAR_EMPTY, CHAR_MIDDLE, CHAR_TOP_BOTTOM },
        { CHAR_HALF_BOTTOM, CHAR_HALF_BOTTOM, CHAR_HALF_TOP }
    },

    <span style=color:#6272a4>// 4
</span><span style=color:#6272a4></span>    {
        { CHAR_FULL, CHAR_EMPTY, CHAR_HALF_BOTTOM },
        { CHAR_FULL, CHAR_HALF_BOTTOM, CHAR_FULL },
        { CHAR_EMPTY, CHAR_EMPTY, CHAR_FULL }
    },

    <span style=color:#6272a4>// 5
</span><span style=color:#6272a4></span>    {
        { CHAR_FULL, CHAR_HALF_TOP, CHAR_HALF_TOP },
        { CHAR_HALF_TOP, CHAR_MIDDLE, CHAR_HALF_BOTTOM },
        { CHAR_HALF_BOTTOM, CHAR_HALF_BOTTOM, CHAR_BOTTOM_RIGHT }
    },

    <span style=color:#6272a4>// 6
</span><span style=color:#6272a4></span>    {
        { CHAR_TOP_LEFT, CHAR_HALF_TOP, CHAR_HALF_TOP },
        { CHAR_FULL, CHAR_HALF_TOP, CHAR_TOP_RIGHT },
        { CHAR_BOTTOM_LEFT, CHAR_HALF_BOTTOM, CHAR_BOTTOM_RIGHT }
    },

    <span style=color:#6272a4>// 7
</span><span style=color:#6272a4></span>    {
        { CHAR_HALF_TOP, CHAR_HALF_TOP, CHAR_FULL },
        { CHAR_EMPTY, CHAR_HALF_BOTTOM, CHAR_HALF_TOP },
        { CHAR_EMPTY, CHAR_FULL, CHAR_EMPTY }
    },

    <span style=color:#6272a4>// 8
</span><span style=color:#6272a4></span>    {
        { CHAR_HALF_BOTTOM, CHAR_HALF_TOP, CHAR_HALF_BOTTOM },
        { CHAR_TOP_BOTTOM, CHAR_MIDDLE, CHAR_TOP_BOTTOM },
        { CHAR_HALF_TOP, CHAR_HALF_BOTTOM, CHAR_HALF_TOP }
    },

    <span style=color:#6272a4>// 9
</span><span style=color:#6272a4></span>    {
        { CHAR_TOP_LEFT, CHAR_HALF_TOP, CHAR_TOP_RIGHT },
        { CHAR_BOTTOM_LEFT, CHAR_HALF_BOTTOM, CHAR_FULL },
        { CHAR_HALF_BOTTOM, CHAR_HALF_BOTTOM, CHAR_BOTTOM_RIGHT }
    }
};
</code></pre></div><p>Os n√∫meros que ser√£o criados com isso s√£o:</p>
<p><img src=/images/lcd-big-numbers-1-a-5.jpg alt="N√∫meros de 1 a 5 no display">
<img src=/images/lcd-big-numbers-6-a-9.jpg alt="N√∫meros de 6 a 9 no display"></p>
<p>Isso finaliza a parte trabalhosa. Agora resta apenas l√≥gica.</p>
<h2 id=a-l√≥gica-de-exibi√ß√£o-dos-n√∫meros>
A l√≥gica de exibi√ß√£o dos n√∫meros
<a class=heading-link href=#a-l%c3%b3gica-de-exibi%c3%a7%c3%a3o-dos-n%c3%bameros>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>A primeira parte da l√≥gica come√ßa com a cria√ß√£o dos caracteres:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp>LcdBigNumbers<span style=color:#ff79c6>::</span>LcdBigNumbers(LiquidCrystal_I2C <span style=color:#ff79c6>*</span>lcd)
{
    <span style=color:#ff79c6>this</span><span style=color:#ff79c6>-&gt;</span>lcd <span style=color:#ff79c6>=</span> lcd;
}

<span style=color:#8be9fd>void</span> LcdBigNumbers<span style=color:#ff79c6>::</span>init()
{
    <span style=color:#ff79c6>for</span> (<span style=color:#8be9fd>uint8_t</span> i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; i <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>8</span>; i<span style=color:#ff79c6>++</span>) {
        <span style=color:#ff79c6>this</span><span style=color:#ff79c6>-&gt;</span>lcd<span style=color:#ff79c6>-&gt;</span>createChar(i, customChars[i]);
    }
}
</code></pre></div><p>O m√©todo <code>init()</code> ir√° percorrer todo o vetor de caracteres customizados, criando
todos eles no controlador do LCD. O primeiro par√¢metro do <code>createChar()</code> √© o
endere√ßo que o o caractere deve ocupar na mem√≥ria, e o segundo √© um vetor com os
bytes que foram o padr√£o de exibi√ß√£o.</p>
<p>O m√©todo <code>printNumber()</code> √© utilizado para decompor um n√∫mero em v√°rios d√≠gitos e
depois exibir cada d√≠gito separadamente, com um pequeno espa√ßo entre eles. O
m√©todo recebe por par√¢metro a coluna e a linha do primeiro &ldquo;pixel&rdquo; (topo esquerdo)
onde ser√° exibido o n√∫mero.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#8be9fd>void</span> LcdBigNumbers<span style=color:#ff79c6>::</span>printNumber(
    <span style=color:#ff79c6>const</span> <span style=color:#8be9fd>unsigned</span> <span style=color:#8be9fd>long</span> <span style=color:#8be9fd>int</span> number,
    <span style=color:#8be9fd>uint8_t</span> column,
    <span style=color:#8be9fd>uint8_t</span> row
)
{
    <span style=color:#8be9fd>uint8_t</span> digits[<span style=color:#bd93f9>10</span>];  <span style=color:#6272a4>// Hard limit de 10 d√≠gitos
</span><span style=color:#6272a4></span>    <span style=color:#8be9fd>uint8_t</span> count <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>, i;
    <span style=color:#8be9fd>unsigned</span> <span style=color:#8be9fd>long</span> <span style=color:#8be9fd>int</span> moreNumbers <span style=color:#ff79c6>=</span> number;

    <span style=color:#ff79c6>do</span> {
        digits[count<span style=color:#ff79c6>++</span>] <span style=color:#ff79c6>=</span> moreNumbers <span style=color:#ff79c6>%</span> <span style=color:#bd93f9>10</span>;
        moreNumbers <span style=color:#ff79c6>/=</span> <span style=color:#bd93f9>10</span>;
    } <span style=color:#ff79c6>while</span> (count <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>10</span> <span style=color:#ff79c6>&amp;&amp;</span> moreNumbers <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>0</span>);

    <span style=color:#ff79c6>for</span> (i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; i <span style=color:#ff79c6>&lt;</span> count; i<span style=color:#ff79c6>++</span>) {
        <span style=color:#ff79c6>this</span><span style=color:#ff79c6>-&gt;</span>printDigit(digits[count <span style=color:#ff79c6>-</span> i <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>1</span>], column <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>4</span> <span style=color:#ff79c6>*</span> i, row);
    }
}
</code></pre></div><p><strong>Nota: revisando o c√≥digo acima durante a atualiza√ß√£o do blog para o Hugo,
encontrei uma pequena grande falha de <em><a href=https://pt.wikipedia.org/wiki/Transbordamento_de_dados>buffer overflow</a></em> na condi√ß√£o do
<code>while</code>: <code>count &lt;= 10</code> deveria ser <code>count &lt; 10</code>. O c√≥digo acima j√° est√° corrigido.</strong></p>
<p>Esse talvez seja o c√≥digo mais complexo em todo o projeto at√© agora, mas at√© que
√© simples. O n√∫mero recebido vai sendo dividido por 10 at√© chegar a zero, e o
resto da divis√£o (que √© o mesmo que o √∫ltimo d√≠gito do n√∫mero) √© adicionado a
uma lista. No fim, essa lista ter√° todos os d√≠gitos do n√∫mero em ordem inversa.</p>
<p>Depois de decompor o n√∫mero, a lista de d√≠gitos √© percorrida do final para o come√ßo
e, para cada d√≠gito, √© chamado o outro m√©todo da biblioteca, o <code>printDigit()</code>.
Para cada d√≠gito exibido, s√£o avan√ßadas 4 colunas para exibir o pr√≥ximo. Como
cada n√∫mero sempre ocupa 3 colunas, isso deixa uma coluna de espa√ßo entre os
d√≠gitos (<em>e isso tamb√©m pode causar um pequeno bug, que n√£o afeta o Placarduino,
porque essa coluna de espa√ßo entre os d√≠gitos n√£o √© apagada, ent√£o se havia outra
coisa escrita nesse espa√ßo antes, ir√° continuar aparecendo entre os d√≠gitos</em>).</p>
<p>Por fim, a l√≥gica para exibir um d√≠gito no display LCD. Como a defini√ß√£o de quais
caracteres formam o n√∫mero j√° foi feita antes na matriz <code>numberChars</code>, o √∫nico
trabalho desse m√©todo √© percorrer essa matriz, posicionar o cursor e exibir o
caractere:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#8be9fd>void</span> LcdBigNumbers<span style=color:#ff79c6>::</span>printDigit(<span style=color:#ff79c6>const</span> <span style=color:#8be9fd>uint8_t</span> digit, <span style=color:#8be9fd>uint8_t</span> column, <span style=color:#8be9fd>uint8_t</span> row)
{
    <span style=color:#ff79c6>if</span> (digit <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>9</span>) {
        <span style=color:#ff79c6>return</span>;
    }

    <span style=color:#8be9fd>uint8_t</span> r, c;

    <span style=color:#ff79c6>for</span> (r <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; r <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>3</span>; r<span style=color:#ff79c6>++</span>) {
        <span style=color:#ff79c6>this</span><span style=color:#ff79c6>-&gt;</span>lcd<span style=color:#ff79c6>-&gt;</span>setCursor(column, row <span style=color:#ff79c6>+</span> r);

        <span style=color:#ff79c6>for</span> (c <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; c <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>3</span>; c<span style=color:#ff79c6>++</span>) {
            <span style=color:#ff79c6>this</span><span style=color:#ff79c6>-&gt;</span>lcd<span style=color:#ff79c6>-&gt;</span>write(numberChars[digit][r][c]);
        }
    }
}
</code></pre></div><h2 id=integrando-o-lcdbignumbers-com-o-placarduino>
Integrando o LcdBigNumbers com o Placarduino
<a class=heading-link href=#integrando-o-lcdbignumbers-com-o-placarduino>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>O uso da biblioteca para exibir os pontos dos jogadores no placar vai simplificar
a fun√ß√£o <code>printScore()</code> atual. Mas, primeiro, a biblioteca deve ser inclu√≠da e
inicializada.</p>
<p>No come√ßo do arquivo, depois dos outros <code>#include</code>&rsquo;s:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&#34;LcdBigNumbers.h&#34;</span><span style=color:#ff79c6>
</span></code></pre></div><p>Um objeto LcdBigNumbers deve ser criado logo depois do LiquidCrystal_I2C, passando
um ponteiro para a vari√°vel <code>lcd</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>LiquidCrystal_I2C lcd(LCD_I2C_ADDR, LCD_COLS, LCD_ROWS);
LcdBigNumbers bigNumbers(&amp;lcd);
</code></pre></div><p>O m√©todo <code>init()</code>, que ir√° criar todos os caracteres customizados, deve ser
chamado logo ap√≥s a inicializa√ß√£o do LCD:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>setupLCD</span>()
{
    lcd.init();
    bigNumbers.init();

    lcd.backlight();
}
</code></pre></div><p>Por fim, a fun√ß√£o <code>printScore()</code> √© alterada para exibir os nomes dos dois
jogadores na primeira linha, um alinhado √† esquerda e outro √† direita. A
exibi√ß√£o dos nomes ainda √© feita utilizando <code>lcd.print()</code>, mas a exibi√ß√£o dos
pontos agora √© feita com <code>bigNumbers.printNumber()</code>, alinhando, como os nomes,
√† esquerda e √† direita.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>printScore</span>()
{
    lcd.clear();

    lcd.setCursor(<span style=color:#bd93f9>0</span>, <span style=color:#bd93f9>0</span>);
    lcd.print(firstPlayerName);

    <span style=color:#6272a4>// Alinha o nome do jogador √† direita
</span><span style=color:#6272a4></span>    lcd.setCursor(LCD_COLS <span style=color:#ff79c6>-</span> strlen(secondPlayerName), <span style=color:#bd93f9>0</span>);
    lcd.print(secondPlayerName);

    bigNumbers.printNumber(firstPlayerScore, <span style=color:#bd93f9>0</span>, <span style=color:#bd93f9>1</span>);

    <span style=color:#6272a4>// Altera coluna inicial de acordo com valor da pontua√ß√£o para
</span><span style=color:#6272a4></span>    <span style=color:#6272a4>// manter alinhado √† direita
</span><span style=color:#6272a4></span>    <span style=color:#ff79c6>if</span> (secondPlayerScore <span style=color:#ff79c6>&gt;=</span> <span style=color:#bd93f9>10</span>) {
        bigNumbers.printNumber(secondPlayerScore, LCD_COLS <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>7</span>, <span style=color:#bd93f9>1</span>);
    }
    <span style=color:#ff79c6>else</span> {
        bigNumbers.printNumber(secondPlayerScore, LCD_COLS <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>3</span>, <span style=color:#bd93f9>1</span>);
    }
}
</code></pre></div><h2 id=resultado>
Resultado
<a class=heading-link href=#resultado>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p><img src=/images/placarduino-big-numbers-lcd.jpg alt="N√∫meros grandes no Placarduino"></p>
<p>Como sempre, o c√≥digo est√° no GitHub:</p>
<ul>
<li>A vers√£o desse post: <a href=https://github.com/eduardoweiland/placarduino/tree/v1.3>https://github.com/eduardoweiland/placarduino/tree/v1.3</a></li>
<li>Vers√£o mais atual: <a href=https://github.com/eduardoweiland/placarduino>https://github.com/eduardoweiland/placarduino</a></li>
</ul>
</div>
<footer>
<section class=see-also>
<h3 id=see-also-in-placarduino>
See also in placarduino
<a class=heading-link href=#see-also-in-placarduino>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h3>
<nav>
<ul>
<li>
<a href=/posts/2018/02/reset-automatico-do-placarduino-apos-o-fim-do-jogo/>Reset autom√°tico do Placarduino ap√≥s o fim do jogo</a>
</li>
<li>
<a href=/posts/2018/02/fim-de-jogo-para-o-placarduino/>Fim de jogo para o Placarduino</a>
</li>
<li>
<a href=/posts/2018/01/cartoes-de-acesso-para-o-placarduino/>Cart√µes de acesso para o Placarduino</a>
</li>
<li>
<a href=/posts/2018/01/refatoracao-do-placarduino/>Refatora√ß√£o do Placarduino</a>
</li>
<li>
<a href=/posts/2018/01/atualizacao-do-placarduino-reducao-de-pontos/>Atualiza√ß√£o do Placarduino: redu√ß√£o de pontos</a>
</li>
</ul>
</nav>
</section>
</footer>
</article>
</section>
</div>
<footer class=footer>
<section class=container>
&copy;
2011 -
2021
Eduardo Weiland
&#183;
<a rel="license noopener" href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA 4.0</a>
&#183;
<a rel=noopener href=https://gitlab.com/eduardoweiland/homepage>Free Software</a>
</section>
</footer>
</main>
<script src=/js/coder.min.235666b114443867d43eeb5799d51f6252965e5163f338285e113fa381d3d27e.js integrity="sha256-I1ZmsRREOGfUPutXmdUfYlKWXlFj8zgoXhE/o4HT0n4="></script>
</body>
</html>